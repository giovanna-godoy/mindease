<div class="p-4 md:p-6 space-y-4 md:space-y-6 max-w-7xl mx-auto">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
    <div>
      <h1 class="flex items-center gap-2 text-xl md:text-2xl font-bold">
        <mat-icon class="material-icons-rounded" [style.color]="'var(--primary)'">dashboard_customize</mat-icon>
        Organizador de Tarefas
      </h1>
      <p class="text-muted-foreground mt-1 text-sm md:text-base" [style.color]="'var(--muted-foreground)'">
        Gerencie suas tarefas de forma simples e visual
      </p>
    </div>
    <button
      (click)="openNewTaskDialog()"
      class="flex items-center gap-2 px-4 py-2 rounded-lg font-medium w-full sm:w-auto"
      [style.backgroundColor]="'var(--primary)'"
      [style.color]="'var(--primary-foreground)'"
    >
      <mat-icon class="material-icons-rounded">add</mat-icon>
      Nova Tarefa
    </button>
  </div>

  <!-- Kanban Board -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <!-- A Fazer -->
    <div class="rounded-lg p-4" [style.backgroundColor]="'var(--card)'" [style.borderColor]="'var(--border)'" style="border: 1px solid">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-2">
          <div class="w-3 h-3 rounded-full" [style.backgroundColor]="'#9CA3AF'"></div>
          <h2 class="font-semibold">A Fazer <span class="text-xs text-muted-foreground ml-1">(2)</span></h2>
        </div>
        <button (click)="openNewTaskDialog('todo')" class="text-muted-foreground hover:text-foreground">
          <mat-icon class="material-icons-rounded text-lg">add</mat-icon>
        </button>
      </div>
      <div class="space-y-3" 
           (dragover)="onDragOver($event)" 
           (drop)="onDrop($event, 'todo')">
        <div *ngFor="let task of tasks | filter:'todo'" 
             class="p-3 rounded-lg cursor-move" 
             [style.backgroundColor]="'var(--muted)'" 
             [style.borderColor]="'var(--border)'" 
             style="border: 1px solid"
             draggable="true"
             (dragstart)="onDragStart($event, task)"
             (dragover)="onDragOver($event)"
             (drop)="onDrop($event, 'todo')">
          <div class="flex items-start justify-between mb-2">
            <h3 class="font-medium text-sm">{{ task.title }}</h3>
            <div class="flex gap-1">
              <button (click)="openEditTaskDialog(task)" class="text-muted-foreground hover:text-foreground" title="Editar tarefa">
                <mat-icon class="material-icons-rounded text-sm">edit</mat-icon>
              </button>
            </div>
          </div>
          <p class="text-xs text-muted-foreground mb-3">{{ task.description }}</p>
          <div class="detailed-info text-xs mb-2" [style.color]="'var(--muted-foreground)'" *ngIf="task.createdAt">
            Criada em: {{ task.createdAt | date:'dd/MM/yyyy HH:mm' }}
          </div>
          <div class="flex flex-wrap gap-1 mb-2">
            <span *ngFor="let subtask of task.subtasks" class="text-xs px-2 py-1 rounded" [style.backgroundColor]="subtask.completed ? 'var(--accent)' : 'var(--secondary)'">
              <input type="checkbox" [checked]="subtask.completed" class="mr-1" />
              {{ subtask.title }}
            </span>
          </div>
          <div class="detailed-info text-xs mb-2" [style.color]="'var(--muted-foreground)'" *ngIf="getTotalSubtasks(task) > 0">
            Progresso: {{ getCompletedSubtasks(task) }}/{{ getTotalSubtasks(task) }} subtarefas concluídas
          </div>
          <div class="flex items-center justify-between text-xs text-muted-foreground">
            <div class="flex items-center gap-1">
              <mat-icon class="material-icons-rounded text-sm">schedule</mat-icon>
              {{ task.estimatedTime }}min
            </div>
            <span *ngIf="task.priority" class="px-2 py-0.5 rounded text-xs font-medium" [style.backgroundColor]="getPriorityColor(task.priority)" [style.color]="'white'">
              {{ task.priority }}
            </span>
          </div>
          <div *ngIf="task.tags" class="flex flex-wrap gap-1 mt-2">
            <span *ngFor="let tag of task.tags" class="text-xs px-2 py-0.5 rounded" [style.backgroundColor]="'var(--secondary)'" [style.color]="'var(--secondary-foreground)'">
              {{ tag }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Em Progresso -->
    <div class="rounded-lg p-4" [style.backgroundColor]="'var(--card)'" [style.borderColor]="'var(--border)'" style="border: 1px solid">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-2">
          <div class="w-3 h-3 rounded-full" [style.backgroundColor]="'#3B82F6'"></div>
          <h2 class="font-semibold">Em Progresso <span class="text-xs text-muted-foreground ml-1">(2)</span></h2>
        </div>
        <button (click)="openNewTaskDialog('in_progress')" class="text-muted-foreground hover:text-foreground">
          <mat-icon class="material-icons-rounded text-lg">add</mat-icon>
        </button>
      </div>
      <div class="space-y-3" 
           (dragover)="onDragOver($event)" 
           (drop)="onDrop($event, 'in_progress')">
        <div *ngFor="let task of tasks | filter:'in_progress'" 
             class="p-3 rounded-lg cursor-move" 
             [style.backgroundColor]="'var(--muted)'" 
             [style.borderColor]="'var(--border)'" 
             style="border: 1px solid"
             draggable="true"
             (dragstart)="onDragStart($event, task)"
             (dragover)="onDragOver($event)"
             (drop)="onDrop($event, 'in_progress')">
          <div class="flex items-start justify-between mb-2">
            <h3 class="font-medium text-sm">{{ task.title }}</h3>
            <div class="flex gap-1">
              <button (click)="openEditTaskDialog(task)" class="text-muted-foreground hover:text-foreground" title="Editar tarefa">
                <mat-icon class="material-icons-rounded text-sm">edit</mat-icon>
              </button>
            </div>
          </div>
          <p class="text-xs text-muted-foreground mb-3">{{ task.description }}</p>
          <div class="flex flex-wrap gap-1 mb-2">
            <span *ngFor="let subtask of task.subtasks" class="text-xs px-2 py-1 rounded" [style.backgroundColor]="subtask.completed ? 'var(--accent)' : 'var(--secondary)'">
              <input type="checkbox" [checked]="subtask.completed" class="mr-1" />
              {{ subtask.title }}
            </span>
          </div>
          <div class="flex items-center justify-between text-xs text-muted-foreground">
            <div class="flex items-center gap-1">
              <mat-icon class="material-icons-rounded text-sm">schedule</mat-icon>
              {{ task.estimatedTime }}min
            </div>
            <span *ngIf="task.priority" class="px-2 py-0.5 rounded text-xs font-medium" [style.backgroundColor]="getPriorityColor(task.priority)" [style.color]="'white'">
              {{ task.priority }}
            </span>
          </div>
          <div *ngIf="task.tags" class="flex flex-wrap gap-1 mt-2">
            <span *ngFor="let tag of task.tags" class="text-xs px-2 py-0.5 rounded" [style.backgroundColor]="'var(--secondary)'" [style.color]="'var(--secondary-foreground)'">
              {{ tag }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Concluído -->
    <div class="rounded-lg p-4" [style.backgroundColor]="'var(--card)'" [style.borderColor]="'var(--border)'" style="border: 1px solid">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-2">
          <div class="w-3 h-3 rounded-full" [style.backgroundColor]="'var(--accent)'"></div>
          <h2 class="font-semibold">Concluído <span class="text-xs text-muted-foreground ml-1">(1)</span></h2>
        </div>
        <button (click)="openNewTaskDialog('done')" class="text-muted-foreground hover:text-foreground">
          <mat-icon class="material-icons-rounded text-lg">add</mat-icon>
        </button>
      </div>
      <div class="space-y-3" 
           (dragover)="onDragOver($event)" 
           (drop)="onDrop($event, 'done')">
        <div *ngFor="let task of tasks | filter:'done'" 
             class="p-3 rounded-lg cursor-move" 
             [style.backgroundColor]="'var(--muted)'" 
             [style.borderColor]="'var(--border)'" 
             style="border: 1px solid"
             draggable="true"
             (dragstart)="onDragStart($event, task)"
             (dragover)="onDragOver($event)"
             (drop)="onDrop($event, 'done')">
          <div class="flex items-start justify-between mb-2">
            <h3 class="font-medium text-sm line-through">{{ task.title }}</h3>
            <div class="flex gap-1">
              <button (click)="openEditTaskDialog(task)" class="text-muted-foreground hover:text-foreground" title="Editar tarefa">
                <mat-icon class="material-icons-rounded text-sm">edit</mat-icon>
              </button>
            </div>
          </div>
          <p class="text-xs text-muted-foreground mb-3">{{ task.description }}</p>
          <div class="flex flex-wrap gap-1 mb-2">
            <span *ngFor="let subtask of task.subtasks" class="text-xs px-2 py-1 rounded" [style.backgroundColor]="'var(--accent)'">
              <input type="checkbox" checked disabled class="mr-1" />
              {{ subtask.title }}
            </span>
          </div>
          <div class="flex items-center justify-between text-xs text-muted-foreground">
            <div class="flex items-center gap-1">
              <mat-icon class="material-icons-rounded text-sm">schedule</mat-icon>
              {{ task.estimatedTime }}min
            </div>
            <span *ngIf="task.priority" class="px-2 py-0.5 rounded text-xs font-medium" [style.backgroundColor]="getPriorityColor(task.priority)" [style.color]="'white'">
              {{ task.priority }}
            </span>
          </div>
          <div *ngIf="task.tags" class="flex flex-wrap gap-1 mt-2">
            <span *ngFor="let tag of task.tags" class="text-xs px-2 py-0.5 rounded" [style.backgroundColor]="'var(--secondary)'" [style.color]="'var(--secondary-foreground)'">
              {{ tag }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Task Form Dialog -->
<app-task-form-dialog
  [isOpen]="isDialogOpen"
  [task]="dialogTask"
  [defaultStatus]="dialogDefaultStatus"
  (openChange)="onDialogOpenChange($event)"
  (taskSubmit)="onTaskSubmit($event)"
></app-task-form-dialog>
