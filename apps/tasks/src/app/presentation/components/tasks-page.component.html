<div class="p-4 md:p-6 space-y-4 md:space-y-6 max-w-7xl mx-auto">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
    <div>
      <h1 class="flex items-center gap-2 text-xl md:text-2xl font-bold">
        <mat-icon class="material-icons-rounded" [style.color]="'var(--primary)'">dashboard_customize</mat-icon>
        Organizador de Tarefas
      </h1>
      <p class="text-muted-foreground mt-1 text-sm md:text-base" [style.color]="'var(--muted-foreground)'">
        Gerencie suas tarefas de forma simples e visual
      </p>
    </div>
    <div class="flex gap-2">
      <button
        (click)="openNewTaskDialog()"
        class="flex items-center gap-2 px-4 py-2 rounded-lg font-medium w-full sm:w-auto"
        [style.backgroundColor]="'var(--primary)'"
        [style.color]="'var(--primary-foreground)'"
      >
        <mat-icon class="material-icons-rounded">add</mat-icon>
        Nova Tarefa
      </button>
      <button
        (click)="refreshTasks()"
        class="flex items-center gap-2 px-4 py-2 rounded-lg font-medium border"
        [style.borderColor]="'var(--border)'"
        [style.color]="'var(--card-foreground)'"
        title="Atualizar tarefas"
      >
        <mat-icon class="material-icons-rounded">refresh</mat-icon>
      </button>
    </div>
  </div>

  <!-- Kanban Board -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <!-- A Fazer -->
    <div class="rounded-lg p-4" [style.backgroundColor]="'var(--card)'" [style.borderColor]="'var(--border)'" style="border: 1px solid">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-2">
          <div class="w-3 h-3 rounded-full" [style.backgroundColor]="'#9CA3AF'"></div>
          <h2 class="font-semibold">A Fazer <span class="text-xs text-muted-foreground ml-1">({{ getTaskCountByStatus('todo') }})</span></h2>
        </div>
        <button (click)="openNewTaskDialog('todo')" class="text-muted-foreground hover:text-foreground">
          <mat-icon class="material-icons-rounded text-lg">add</mat-icon>
        </button>
      </div>
      <div class="space-y-3">
        <div *ngFor="let task of tasks | filter:'todo'" 
             class="p-4 rounded-lg" 
             [style.backgroundColor]="'var(--surface-color)'" 
             [style.borderColor]="'var(--border)'" 
             style="border: 1px solid">
          <div class="flex items-start justify-between mb-2">
            <h3 class="font-semibold text-base">{{ task.title }}</h3>
            <button (click)="deleteTask(task)" class="text-red-500 hover:text-red-600" title="Excluir tarefa">
              <mat-icon class="material-icons-rounded text-lg">delete</mat-icon>
            </button>
          </div>
          <p class="complexity-medium text-sm mb-3" [style.color]="'var(--muted-foreground)'">{{ task.description }}</p>
          
          <div *ngIf="addingSubtaskFor === task.id" class="complexity-complete mb-3 flex gap-2">
            <input 
              type="text" 
              [(ngModel)]="newSubtaskTitle"
              placeholder="Nova subtarefa..."
              class="flex-1 px-3 py-2 rounded-lg text-sm"
              [style.backgroundColor]="'var(--muted)'"
              [style.border]="'1px solid var(--border)'"
              (keyup.enter)="addSubtask(task)"
              (keyup.escape)="cancelAddSubtask()"
            />
            <button 
              (click)="addSubtask(task)"
              class="px-3 py-2 rounded-lg"
              [style.backgroundColor]="'var(--primary)'"
              [style.color]="'white'"
            >
              <mat-icon class="material-icons-rounded text-sm">check</mat-icon>
            </button>
          </div>

          <button 
            *ngIf="addingSubtaskFor !== task.id"
            (click)="showAddSubtask(task.id)"
            class="complexity-complete text-sm mb-3 flex items-center gap-1" 
            [style.color]="'var(--primary)'"
          >
            <mat-icon class="material-icons-rounded text-sm">add_circle_outline</mat-icon>
            Adicionar subtarefa
          </button>

          <div class="complexity-complete flex flex-wrap gap-2 mb-3">
            <span class="px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1" [style.backgroundColor]="getPriorityColor(task.priority)" [style.color]="'white'">
              <mat-icon class="material-icons-rounded" style="font-size: 16px; width: 16px; height: 16px;">label</mat-icon>
              {{ task.priority === 'low' ? 'Baixa' : task.priority === 'medium' ? 'Média' : 'Alta' }}
            </span>
            <span *ngIf="task.subtasks?.length" class="px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1" [style.backgroundColor]="'var(--secondary)'" [style.color]="'var(--secondary-foreground)'">
              <mat-icon class="material-icons-rounded" style="font-size: 16px; width: 16px; height: 16px;">check_circle</mat-icon>
              {{ getCompletedSubtasks(task) }}/{{ getTotalSubtasks(task) }}
            </span>
            <span class="px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1" [style.backgroundColor]="'var(--secondary)'" [style.color]="'var(--secondary-foreground)'">
              <mat-icon class="material-icons-rounded" style="font-size: 16px; width: 16px; height: 16px;">schedule</mat-icon>
              {{ task.estimatedTime }}min
            </span>
          </div>

          <div class="flex gap-2">
            <button class="px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-1" [style.backgroundColor]="'var(--secondary)'" [style.color]="'var(--primary)'">
              <mat-icon class="material-icons-rounded text-sm">arrow_forward</mat-icon>
              Em Progresso
            </button>
            <button class="px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-1" [style.backgroundColor]="'var(--secondary)'" [style.color]="'var(--primary)'">
              <mat-icon class="material-icons-rounded text-sm">arrow_forward</mat-icon>
              Concluído
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Em Progresso -->
    <div class="rounded-lg p-4" [style.backgroundColor]="'var(--card)'" [style.borderColor]="'var(--border)'" style="border: 1px solid">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-2">
          <div class="w-3 h-3 rounded-full" [style.backgroundColor]="'#3B82F6'"></div>
          <h2 class="font-semibold">Em Progresso <span class="text-xs text-muted-foreground ml-1">({{ getTaskCountByStatus('in_progress') }})</span></h2>
        </div>
        <button (click)="openNewTaskDialog('in_progress')" class="text-muted-foreground hover:text-foreground">
          <mat-icon class="material-icons-rounded text-lg">add</mat-icon>
        </button>
      </div>
      <div class="space-y-3">
        <div *ngFor="let task of tasks | filter:'in_progress'" 
             class="p-4 rounded-lg" 
             [style.backgroundColor]="'var(--surface-color)'" 
             [style.borderColor]="'var(--border)'" 
             style="border: 1px solid">
          <div class="flex items-start justify-between mb-2">
            <h3 class="font-semibold text-base">{{ task.title }}</h3>
            <button (click)="deleteTask(task)" class="text-red-500 hover:text-red-600" title="Excluir tarefa">
              <mat-icon class="material-icons-rounded text-lg">delete</mat-icon>
            </button>
          </div>
          <p class="complexity-medium text-sm mb-3" [style.color]="'var(--muted-foreground)'">{{ task.description }}</p>
          
          <div *ngIf="addingSubtaskFor === task.id" class="complexity-complete mb-3 flex gap-2">
            <input 
              type="text" 
              [(ngModel)]="newSubtaskTitle"
              placeholder="Nova subtarefa..."
              class="flex-1 px-3 py-2 rounded-lg text-sm"
              [style.backgroundColor]="'var(--muted)'"
              [style.border]="'1px solid var(--border)'"
              (keyup.enter)="addSubtask(task)"
              (keyup.escape)="cancelAddSubtask()"
            />
            <button 
              (click)="addSubtask(task)"
              class="px-3 py-2 rounded-lg"
              [style.backgroundColor]="'var(--primary)'"
              [style.color]="'white'"
            >
              <mat-icon class="material-icons-rounded text-sm">check</mat-icon>
            </button>
          </div>

          <button 
            *ngIf="addingSubtaskFor !== task.id"
            (click)="showAddSubtask(task.id)"
            class="complexity-complete text-sm mb-3 flex items-center gap-1" 
            [style.color]="'var(--primary)'"
          >
            <mat-icon class="material-icons-rounded text-sm">add_circle_outline</mat-icon>
            Adicionar subtarefa
          </button>

          <div class="complexity-complete flex flex-wrap gap-2 mb-3">
            <span class="px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1" [style.backgroundColor]="getPriorityColor(task.priority)" [style.color]="'white'">
              <mat-icon class="material-icons-rounded" style="font-size: 16px; width: 16px; height: 16px;">label</mat-icon>
              {{ task.priority === 'low' ? 'Baixa' : task.priority === 'medium' ? 'Média' : 'Alta' }}
            </span>
            <span *ngIf="task.subtasks?.length" class="px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1" [style.backgroundColor]="'var(--secondary)'" [style.color]="'var(--secondary-foreground)'">
              <mat-icon class="material-icons-rounded" style="font-size: 16px; width: 16px; height: 16px;">check_circle</mat-icon>
              {{ getCompletedSubtasks(task) }}/{{ getTotalSubtasks(task) }}
            </span>
            <span class="px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1" [style.backgroundColor]="'var(--secondary)'" [style.color]="'var(--secondary-foreground)'">
              <mat-icon class="material-icons-rounded" style="font-size: 16px; width: 16px; height: 16px;">schedule</mat-icon>
              {{ task.estimatedTime }}min
            </span>
          </div>

          <div class="flex gap-2">
            <button class="px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-1" [style.backgroundColor]="'var(--secondary)'" [style.color]="'var(--primary)'">
              <mat-icon class="material-icons-rounded text-sm">arrow_forward</mat-icon>
              Concluído
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Concluído -->
    <div class="rounded-lg p-4" [style.backgroundColor]="'var(--card)'" [style.borderColor]="'var(--border)'" style="border: 1px solid">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-2">
          <div class="w-3 h-3 rounded-full" [style.backgroundColor]="'var(--accent)'"></div>
          <h2 class="font-semibold">Concluído <span class="text-xs text-muted-foreground ml-1">({{ getTaskCountByStatus('done') }})</span></h2>
        </div>
        <button (click)="openNewTaskDialog('done')" class="text-muted-foreground hover:text-foreground">
          <mat-icon class="material-icons-rounded text-lg">add</mat-icon>
        </button>
      </div>
      <div class="space-y-3">
        <div *ngFor="let task of tasks | filter:'done'" 
             class="p-4 rounded-lg" 
             [style.backgroundColor]="'var(--surface-color)'" 
             [style.borderColor]="'var(--border)'" 
             style="border: 1px solid">
          <div class="flex items-start justify-between mb-2">
            <h3 class="font-semibold text-base">{{ task.title }}</h3>
            <button (click)="deleteTask(task)" class="text-red-500 hover:text-red-600" title="Excluir tarefa">
              <mat-icon class="material-icons-rounded text-lg">delete</mat-icon>
            </button>
          </div>
          <p class="complexity-medium text-sm mb-3" [style.color]="'var(--muted-foreground)'">{{ task.description }}</p>

          <div class="complexity-complete flex flex-wrap gap-2 mb-3">
            <span class="px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1" [style.backgroundColor]="getPriorityColor(task.priority)" [style.color]="'white'">
              <mat-icon class="material-icons-rounded" style="font-size: 16px; width: 16px; height: 16px;">label</mat-icon>
              {{ task.priority === 'low' ? 'Baixa' : task.priority === 'medium' ? 'Média' : 'Alta' }}
            </span>
            <span *ngIf="task.subtasks?.length" class="px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1" [style.backgroundColor]="'var(--accent)'" [style.color]="'white'">
              <mat-icon class="material-icons-rounded" style="font-size: 16px; width: 16px; height: 16px;">check_circle</mat-icon>
              {{ getTotalSubtasks(task) }}/{{ getTotalSubtasks(task) }}
            </span>
            <span class="px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1" [style.backgroundColor]="'var(--secondary)'" [style.color]="'var(--secondary-foreground)'">
              <mat-icon class="material-icons-rounded" style="font-size: 16px; width: 16px; height: 16px;">schedule</mat-icon>
              {{ task.estimatedTime }}min
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Task Form Dialog -->
<app-task-form-dialog
  [isOpen]="isDialogOpen"
  [task]="dialogTask"
  [defaultStatus]="dialogDefaultStatus"
  (openChange)="onDialogOpenChange($event)"
  (taskSubmit)="onTaskSubmit($event)"
></app-task-form-dialog>
